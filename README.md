# SparkRTC

SparkRTC is built on WebRTC.
The major difference is the goal -- SparkRTC is designed for ultra low latency, with coordinations across a series of modules in WebRTC.

**WebRTC is a free, open software project** that provides browsers and mobile
applications with Real-Time Communications (RTC) capabilities via simple APIs.
The WebRTC components have been optimized to best serve this purpose.

**Our mission:** To enable rich, high-quality RTC applications to be
developed for the browser, mobile platforms, and IoT devices, and allow them
all to communicate via a common set of protocols.

The WebRTC initiative is a project supported by Google, Mozilla and Opera,
amongst others.

## Before You Start

First, be sure to install the [prerequisite software](https://webrtc.github.io/webrtc-org/native-code/development/prerequisite-sw/).


## Getting the Code

For desktop development:

Clone the current repo:
```
git clone https://github.com/hkust-spark/sparkrtc.git
```
Enter the root directory of the repo:
```
cd ./sparkrtc
```
Clone the submodules ([openh264](https://github.com/hkust-spark/openh264) and [ffmpeg](https://github.com/hkust-spark/openh264)), which are also modified by us:
```
git submodule update --init --recursive
```
Sync with other WebRTC-related repos using the `gclient` tool installed before.
```
gclient sync
```

NOTICE: During your first sync, you’ll have to accept the license agreement of the Google Play Services SDK.

The checkout size is large due the use of the Chromium build toolchain and many dependencies. 

## Generating Ninja project files
[Ninja](https://ninja-build.org/) is the default build system for all platforms.
[Ninja](https://ninja-build.org/) project files are generated using [GN](https://gn.googlesource.com/gn/+/master/README.md). They're put in a directory of your choice, like `out/Debug`, but you can use any directory for keeping multiple configurations handy.

To generate project files using the defaults (Debug build), run (in the root directory of the repo):
```
gn gen out/Default
```
See the [GN](https://gn.googlesource.com/gn/+/master/README.md) documentation for all available options. 

## Compiling
When you have Ninja project files generated (see previous section), compile using:

For Ninja project files generated in out/Default:
```
ninja -C out/Default
```

## Example Applications
WebRTC contains several example applications, which can be found under `src/webrtc/examples` and `src/talk/examples`. Higher level applications are listed first.

Peerconnection consist of two applications using the WebRTC Native APIs:

* A server application, with target name `peerconnection_server`

* A client application, with target name `peerconnection_client` (not currently supported on Mac/Android)

The client application has simple voice and video capabilities. The server enables client applications to initiate a call between clients by managing signaling messages generated by the clients.

**Setting up P2P calls between peerconnection_clients:** 
Start peerconnection_server. You should see the following message indicating that it is running:
```
Server listening on port 8888
```

Start any number of `peerconnection_clients` and connect them to the server. The client UI consists of a few parts:

**Connecting to a server:** When the application is started you must specify which machine (by IP address) the server application is running on. Once that is done you can press Connect or the return button.

**Select a peer:** Once successfully connected to a server, you can connect to a peer by double-clicking or select+press return on a peer’s name.

**Video chat:** When a peer has been successfully connected to, a video chat will be displayed in full window.

**Ending chat session:** Press Esc. You will now be back to selecting a peer.

**Ending connection:** Press Esc and you will now be able to select which server to connect to.

For more guidelines, see [here](https://webrtc.github.io/webrtc-org/native-code/development/).